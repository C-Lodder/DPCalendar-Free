DPCalendar=window.DPCalendar||{},function(e){"use strict";e.createCalendar=function(t,a){if(e.loader("hide",t.parent()[0]),a.defaultDate=moment(a.year+"-"+e.pad(parseInt(a.month),2)+"-"+e.pad(a.date,2)),a.use_hash){for(var n=window.location.hash.replace(/&amp;/gi,"&").split("&"),r=0;r<n.length;r++)n[r].match("^#year")&&(a.year=n[r].substring(6)),n[r].match("^month")&&(a.month=n[r].substring(6)),n[r].match("^day")&&(a.date=n[r].substring(4)),n[r].match("^view")&&(a.defaultView=n[r].substring(5));window.addEventListener("hashchange",function(){for(var e=new Date,n=e.getFullYear(),r=e.getMonth()+1,o=e.getDate(),l=a.defaultView,i=window.location.hash.replace(/&amp;/gi,"&").split("&"),s=0;s<i.length;s++)i[s].match("^#year")&&(n=i[s].substring(6)),i[s].match("^month")&&(r=i[s].substring(6)-1),i[s].match("^day")&&(o=i[s].substring(4)),i[s].match("^view")&&(l=i[s].substring(5));var d=new Date(n,r,o,0,0,0),c=t.fullCalendar("getDate"),u=t.fullCalendar("getView");d.getYear()==c.year()&&d.month()==c.month()&&d.date()==c.date()||t.fullCalendar("gotoDate",d),u.name!=l&&t.fullCalendar("changeView",l)})}document.body.clientWidth<a.screen_size_list_view&&(a.defaultView="list"),a.schedulerLicenseKey="GPL-My-Project-Is-Open-Source",a.weekNumberTitle="",a.theme=!1,a.startParam="date-start",a.endParam="date-end",a.eventLimitText=Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_MORE",!0),a.allDayText=Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_ALL_DAY",!0),a.buttonText={today:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_TODAY",!0),month:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_MONTH",!0),week:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_WEEK",!0),day:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_DAY",!0),list:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_LIST",!0)},a.listTexts={until:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_UNTIL",!0),past:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_PAST",!0),today:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TODAY",!0),tomorrow:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TOMORROW",!0),thisWeek:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_WEEK",!0),nextWeek:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_WEEK",!0),thisMonth:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_MONTH",!0),nextMonth:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_MONTH",!0),future:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_FUTURE",!0),week:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_WEEK",!0)},a.viewRender=function(n){var r=t.fullCalendar("getDate"),o="year="+r.year()+"&month="+(r.month()+1)+"&day="+r.date()+"&view="+n.name;a.use_hash&&window.location.hash.replace(/&amp;/gi,"&")!=o&&(window.location.hash=o);var l=document.getElementById("dp-calendar-map");l&&l.dpmap&&e.Map.clearMarkers(l.dpmap)},a.eventRender=function(a,n){if(a.view_class&&n.addClass(a.view_class),a.description){var r=a.description;r=(r=r.replace("task=event.delete","task=event.delete&urlhash="+encodeURIComponent(window.location.hash))).replace("task=event.edit","task=event.edit&urlhash="+encodeURIComponent(window.location.hash));var o=document.createElement("div");o.innerHTML=r,tippy(n[0],{interactive:!0,delay:100,arrow:!0,html:o}),a.fgcolor&&n.css("color",a.fgcolor).find(".fc-event-inner").css("color",a.fgcolor)}var l=t[0].parentElement.querySelector(".dpcalendar-map");null!=l&&null!=l.dpmap&&jQuery.each(a.location,function(t,n){var r=JSON.parse(JSON.stringify(n));r.title=a.title,r.color=a.color;var o=a.description;a.url&&(o=o.replace(a.title,'<a href="'+a.url+'"">'+a.title+"</a>")),r.description=o,e.Map.createMarker(l.dpmap,r)})},a.eventDataTransform=function(e){if(e.allDay){var t=moment(e.end);t.add(1,"day"),e.end=t}return e},a.eventDrop=function(a,n,r,o,l,i){e.loader("show",t.parent()[0]),jQuery(o.target).tooltip("hide"),jQuery.ajax({type:"POST",url:"index.php?option=com_dpcalendar&task=event.move",data:{id:a.id,minutes:n.asMinutes(),allDay:0==n.asMinutes()},success:function(n){e.loader("hide",t.parent()[0]);var r=jQuery.parseJSON(n);r.data.url&&(a.url=r.data.url),null!=r.messages&&jQuery("#system-message-container").length&&Joomla.renderMessages(r.messages)}})},a.eventResize=function(a,n,r,o,l,i){e.loader("show",t.parent()[0]),jQuery(o.target).tooltip("hide"),jQuery.ajax({type:"POST",url:"index.php?option=com_dpcalendar&task=event.move",data:{id:a.id,minutes:n.asMinutes(),allDay:!1,onlyEnd:!0},success:function(n){e.loader("hide",t.parent()[0]);var o=jQuery.parseJSON(n);o.data.url&&(a.url=o.data.url),null!=o.messages&&jQuery("#system-message-container").length&&Joomla.renderMessages(o.messages),o.data.success||r()}})},a.eventClick=function(n,r,o){if(r.stopPropagation(),2==a.show_event_as_popup)return!1;if(1==a.show_event_as_popup){var l=new Url(n.url);l.query.tmpl="component",e.modal(l,t.data("popupheight"),function(e){(e.contentDocument||e.contentWindow.document).getElementById("system-message").children.length<1||t.fullCalendar("refetchEvents")})}else window.location=e.encode(n.url);return!1},a.dayClick=function(e,n,r){var o=t.parent().find("form[name=adminForm]");if(o.length>0){n.stopPropagation(),"month"==r.name&&e.hours(8);var l=o.find("#jform_start_date");l.val(e.format(l.attr("format")));var i=o.find("#jform_end_date");i.val(e.format(i.attr("format"))),o.find("#jform_start_date_time").timepicker("setTime",e.toDate()),e.hours(e.hours()+1),o.find("#jform_end_date_time").timepicker("setTime",e.toDate()),1==a.event_create_form&&jQuery(window).width()>600?(new Popper(n.target,o.parent()[0],{onCreate:function(e){e.instance.popper.querySelector("#jform_title").focus()}}),o.parent().show()):(o.find("input[name=task]").val(""),o.submit())}else a.header.right.indexOf("agendaDay")>0&&(t.fullCalendar("gotoDate",e),t.fullCalendar("changeView","agendaDay"))},a.customButtons={},a.header.left.indexOf("datepicker")&&(a.customButtons.datepicker={text:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_SHOW_DATEPICKER"),icon:"icon-calendar",click:function(){var e=document.querySelector(".fc-datepicker-button"),n=document.getElementById(t.attr("id")+"-datepicker-input");n||((n=document.createElement("input")).setAttribute("type","hidden"),n.id=t.attr("id")+"-datepicker-input",e.appendChild(n));var r=new Pikaday({field:n,trigger:e,i18n:{months:a.monthNames,weekdays:a.dayNames,weekdaysShort:a.dayNamesShort},onSelect:function(e){t.fullCalendar("gotoDate",r.getMoment()),this.destroy()}});r.show()}}),a.header.left.indexOf("print")&&(a.customButtons.print={text:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_PRINT"),icon:"icon-print",click:function(){var e=document.location.href.replace(/\?/,"?layout=print&tmpl=component&");e==document.location.href&&(e=document.location.href.replace(/#/,"?layout=print&tmpl=component#"));window.open(e).focus()}}),a.loading=function(a){e.loader(a?"show":"hide",t.parent()[0])},t.data("eventSources",a.eventSources);var o=md5(JSON.stringify(a.eventSources));e.isLocalStorageSupported()&&(null==localStorage.getItem(t.attr("id")+o)?localStorage.setItem(t.attr("id")+o,JSON.stringify(a.eventSources)):a.eventSources=JSON.parse(localStorage.getItem(t.attr("id")+o)));var l=[];for(r=0;r<a.eventSources.length;r++)l.push({url:a.eventSources[r],success:e.extractEvents});a.eventSources=l,t.fullCalendar(jQuery.extend({},a)),jQuery(".fc-icon-icon-print").attr("class",a.icon_print),jQuery(".fc-icon-icon-calendar").attr("class",a.icon_calendar);var i=t[0].parentElement,s=i.querySelector(".dp-calendar-toggle");s&&s.addEventListener("click",function(t){e.fadeToggle(i.querySelector(".dp-calendar-list"),function(e){e?(i.querySelector('i[data-direction="up"]').style.display="inline",i.querySelector('i[data-direction="down"]').style.display="none"):(i.querySelector('i[data-direction="up"]').style.display="none",i.querySelector('i[data-direction="down"]').style.display="inline")})}),jQuery.each(a.eventSources,function(e,t){jQuery("#dp-calendar-list input").each(function(e){var a=jQuery(this);t.url==a.val()&&a.attr("checked",!0)})})},e.updateCalendar=function(t,a){var n=md5(JSON.stringify(a.data("eventSources"))),r=e.isLocalStorageSupported()?JSON.parse(localStorage.getItem(a.attr("id")+n)):[],o={url:t.val(),success:e.extractEvents};if(t.is(":checked"))a.fullCalendar("addEventSource",o),r.push(o.url);else{a.fullCalendar("removeEventSource",o);for(var l=0;l<r.length;l++)value==o.url&&r.splice(index,1)}e.isLocalStorageSupported()&&localStorage.setItem(a.attr("id")+n,JSON.stringify(r))},e.extractEvents=function(e){return e.length&&null!=e[0].messages.message&&document.getElementById("system-message-container")&&Joomla.renderMessages(e[0].messages),e.length&&null!=e[0].data?e[0].data:e}}(DPCalendar);